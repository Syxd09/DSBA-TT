<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>DSBA TIME-TABLE</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="styles.css" />
    <!-- Include html2pdf.js CDN for PDF download -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
</head>
<body>
    <!-- Header with logos and titles -->
    <div class="dsba-header">
        <img src="dsba-logo.png" alt="DSBA Logo" class="header-logo left-logo" />
        <div class="header-center">
            <div class="dsi-title">Dayananda Sagar Institutions (DSI)</div>
            <div class="dsba-title">Dayananda Sagar Business Academy (DSBA)</div>
            <div class="header-subtitle">
                Recognised by the Government of Karnataka, Permanently Affiliated to Bangalore University &amp;<br />
                Approved by A.I.C.T.E., Accredited by NAAC
            </div>
        </div>
        <img src="iq-logo.jpg" alt="IQ Logo" class="header-logo right-logo" />
    </div>

    <!-- Editable top info fields -->
    <div class="edit-info">
        <label>
            Program:
            <select id="program-input">
                <option value="BCA" selected>BCA</option>
                <option value="BBA">BBA</option>
                <option value="B.Com">B.Com</option>
            </select>
        </label>
        <label>
            Semester:
            <select id="semester-input">
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3" selected>3</option>
                <option value="4">4</option>
                <option value="5">5</option>
                <option value="6">6</option>
            </select>
        </label>
        <label>
            Batch:
            <input id="batch-input" type="text" value="2025-28" />
        </label>
        <label>
            Effective Date:
            <input id="date-input" type="date" value="2025-07-30" />
        </label>
        <label>
            Class Room:
            <input id="classroom-input" type="text" value="103" />
        </label>
    </div>

    <!-- Buttons for print and PDF download -->
    <div style="text-align:center; margin-bottom:20px;">
        <button id="print-btn" type="button">Print Timetable</button>
        <!-- <button id="pdf-btn" type="button">Download as PDF</button> -->
    </div>

    <!-- Timetable header showing above the table -->
    <div class="timetable-header" id="timetable-header">
        Program: BCA &nbsp;|&nbsp; Semester: 3 &nbsp;|&nbsp; Batch 2025-28 &nbsp;|&nbsp; ODD SEM - 2025-26 AY<br />
        <strong id="effective-date-text">Revised Time Table - Effective from: 30/07/2025</strong>
    </div>

    <!-- Timetable table -->
    <table id="timetable">
        <thead>
            <tr class="timetable-header-row">
                <th></th>
                <th>9:30-10:25</th>
                <th>10:25-10:40</th>
                <th>10:40-10:50</th>
                <th>10:50-11:45</th>
                <th>11:50-12:45</th>
                <th>12:45-1:30</th>
                <th>1:30-2:25</th>
                <th>2:30-3:25</th>
                <th>3:30-4:25</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <th>Monday</th>
                <td class="subject">PST</td>
                <td rowspan="6" class="break">SDA<br /></td>
                <td rowspan="6" class="break"><small>Small Break</small></td>
                <td class="subject">CA</td>
                <td class="subject">ENGLISH</td>
                <td rowspan="6" class="break"><strong>LUNCH BREAK</strong></td>
                <td class="subject">DS</td>
                <td class="subject">K/S/H</td>
                <td class="subject">EVS</td>
            </tr>
            <tr>
                <th>Tuesday</th>
                <td class="subject">PST</td>
                <td class="subject">ENGLISH</td>
                <td class="subject">EVS</td>
                <td class="subject">CA</td>
                <td class="subject">CA-LAB</td>
                <td class="subject">CA-LAB</td>
            </tr>
            <tr>
                <th>Wednesday</th>
                <td class="subject">CA</td>
                <td class="subject">PST</td>
                <td class="subject">CA</td>
                <td class="subject">PST</td>
                <td class="subject">DST</td>
                <td class="subject">K/S/H</td>
            </tr>
            <tr>
                <th>Thursday</th>
                <td class="subject">DST</td>
                <td class="subject">ENGLISH</td>
                <td class="subject">CA</td>
                <td class="subject">CA-LAB</td>
                <td class="subject">PST-LAB</td>
                <td class="subject">Library/AE</td>
            </tr>
            <tr>
                <th>Friday</th>
                <td class="subject">OAT-LAB</td>
                <td class="subject">OAT-LAB</td>
                <td class="subject">PST-LAB</td>
                <td class="subject">OAT-LAB</td>
                <td class="subject">K/S/H</td>
                <td class="subject">CLUB/AE</td>
            </tr>
            <tr>
                <th>Saturday</th>
                <td class="subject">K/S/H</td>
                <td class="subject">Club/AE</td>
                <td class="subject">PST</td>
                <td class="subject">Mentoring</td>
                <td class="subject">Sports</td>
                <td class="subject">&nbsp;</td>
            </tr>
        </tbody>
    </table>

    <!-- Course Details Section -->
    <div id="course-details-wrapper">
        <h3 style="text-align:center;">Course Details</h3>
        <table id="course-details-table" style="margin: 0 auto; width: 100%; max-width: 1100px;">
            <thead>
                <tr>
                    <th>Course Legend</th>
                    <th>Course</th>
                    <th>Faculty</th>
                    <th>No. of Hrs/Week</th>
                </tr>
            </thead>
            <tbody id="course-details-body">
                <tr>
                    <td><input type="text" class="cd-input" placeholder="e.g. 24BCA11" /></td>
                    <td><input type="text" class="cd-input" placeholder="e.g. Discrete Structure" /></td>
                    <td><input type="text" class="cd-input" placeholder="e.g. Prof. Mallikarjuna B" /></td>
                    <td><input type="number" min="1" class="cd-input" placeholder="e.g. 4" /></td>
                </tr>
            </tbody>
        </table>
        <div style="text-align:right; margin:8px 16px;">
            <button id="add-row-cd" type="button">Add Row</button>
            <button id="remove-row-cd" type="button">Remove Last Row</button>
        </div>
        <div class="flex-wrap" style="max-width:1100px; margin:0 auto;">
            <label>
                Class Coordinator:
                <input id="cd-coordinator" type="text" value="" />
            </label>
            <label>
                HOD:
                <input id="cd-hod" type="text" value="" />
            </label>
            <label>
                Principal:
                <span id="cd-principal">Dr. Nikitha Srekantha Swamy</span>
            </label>
        </div>
    </div>

    <p class="note">Class Room: 103</p>

    <!-- Main Script -->
    <script>
        // Timetable subjects: editable free text inputs on click
        document.querySelectorAll('td.subject').forEach(cell => {
            cell.style.cursor = "pointer";
            cell.addEventListener('click', function () {
                if (cell.querySelector('input')) return; // Editing already

                const current = cell.textContent.trim();

                const input = document.createElement('input');
                input.type = 'text';
                input.value = current;
                input.style.width = '100%';
                input.style.boxSizing = 'border-box';
                input.style.fontSize = '1em';

                cell.textContent = '';
                cell.appendChild(input);
                input.focus();

                function finishEdit() {
                    const val = input.value.trim();
                    cell.removeChild(input);
                    cell.textContent = val;
                }

                input.addEventListener('blur', finishEdit);
                input.addEventListener('keydown', e => {
                    if (e.key === 'Enter') {
                        e.preventDefault();
                        finishEdit();
                    } else if (e.key === 'Escape') {
                        e.preventDefault();
                        cell.removeChild(input);
                        cell.textContent = current;
                    }
                });
            });
        });

        // Editable fields references
        const programInput = document.getElementById('program-input');
        const semesterInput = document.getElementById('semester-input');
        const batchInput = document.getElementById('batch-input');
        const dateInput = document.getElementById('date-input');
        const classroomInput = document.getElementById('classroom-input');

        const timetableHeader = document.getElementById('timetable-header');

        function formatDateForPrint(dateString) {
            if (!dateString) return '';
            const d = new Date(dateString);
            if (isNaN(d)) return '';
            return d.toLocaleDateString('en-GB');
        }

        // Update header with current inputs
        function updateHeader() {
            const formattedDate = formatDateForPrint(dateInput.value);
            timetableHeader.innerHTML = `
                Program: ${programInput.value || ''} &nbsp;|&nbsp; Semester: ${semesterInput.value || ''} &nbsp;|&nbsp; Batch: ${batchInput.value || ''} &nbsp;|&nbsp; ODD SEM - 2025-26 AY<br>
                <strong>Revised Time Table - Effective from: ${formattedDate}</strong>
            `;
            document.querySelector('.note').textContent = `Class Room: ${classroomInput.value || ''}`;
        }
        [programInput, semesterInput, batchInput, dateInput, classroomInput].forEach(el => {
            el.addEventListener('input', updateHeader);
            el.addEventListener('change', updateHeader);
        });

        updateHeader();

        // Course Details row management
        const courseDetailsBody = document.getElementById('course-details-body');
        document.getElementById('add-row-cd').onclick = () => {
            const tr = document.createElement('tr');
            tr.innerHTML = `
                <td><input type="text" class="cd-input" placeholder="Cousre code" /></td>
                <td><input type="text" class="cd-input" placeholder="Subject name" /></td>
                <td><input type="text" class="cd-input" placeholder="Faculty name" /></td>
                <td><input type="number" min="1" class="cd-input" placeholder="Hours" /></td>
            `;
            courseDetailsBody.appendChild(tr);
        };
        document.getElementById('remove-row-cd').onclick = () => {
            if (courseDetailsBody.rows.length > 1) {
                courseDetailsBody.deleteRow(-1);
            }
        };

        // Replace inputs with spans for printing & PDF in Course Details
        function handleCourseDetailsPrintMode(enable) {
            Array.from(courseDetailsBody.rows).forEach(row => {
                Array.from(row.cells).forEach(cell => {
                    if (enable && cell.querySelector('input')) {
                        const val = cell.querySelector('input').value;
                        const span = document.createElement('span');
                        span.className = 'cd-print-span';
                        span.textContent = val;
                        cell.appendChild(span);
                        cell.querySelector('input').style.display = 'none';
                    } else if (!enable) {
                        const input = cell.querySelector('input');
                        const span = cell.querySelector('span.cd-print-span');
                        if (span) span.remove();
                        if (input) input.style.display = '';
                    }
                });
            });

            // Coordinator, HOD inputs
            const cdCoord = document.getElementById('cd-coordinator');
            const cdHod = document.getElementById('cd-hod');

            const insertSpan = (input, id) => {
                if (enable && !document.getElementById(id)) {
                    const span = document.createElement('span');
                    span.id = id;
                    span.textContent = input.value;
                    span.style.fontWeight = 'bold';
                    span.style.marginLeft = '8px';
                    input.style.display = 'none';
                    input.parentNode.appendChild(span);
                } else if (!enable && document.getElementById(id)) {
                    document.getElementById(id).remove();
                    input.style.display = '';
                }
            };

            insertSpan(cdCoord, 'cd-coordinator-span');
            insertSpan(cdHod, 'cd-hod-span');
        }

        // Print button functionality
        document.getElementById('print-btn').addEventListener('click', () => {
            const editInfo = document.querySelector('.edit-info');

            if (!editInfo.dataset.printMode) {
                // Hide inputs and show text spans
                Array.from(editInfo.querySelectorAll('input, select')).forEach(input => {
                    const span = document.createElement('span');
                    span.textContent =
                        input.type === 'date' ? formatDateForPrint(input.value) : input.value;
                    span.classList.add('print-span');
                    span.style.marginRight = '20px';
                    input.style.display = 'none';
                    input.parentNode.insertBefore(span, input);
                });
                editInfo.dataset.printMode = "true";
            }

            // Hide Add/Remove buttons in course details for print
            handleCourseDetailsPrintMode(true);
            window.print();

            window.onafterprint = () => {
                if (editInfo.dataset.printMode) {
                    Array.from(editInfo.querySelectorAll('span.print-span')).forEach(span => {
                        span.previousElementSibling.style.display = '';
                        span.remove();
                    });
                    delete editInfo.dataset.printMode;
                }
                handleCourseDetailsPrintMode(false);
            };
        });

        document.getElementById('pdf-btn').addEventListener('click', () => {
    const editInfo = document.querySelector('.edit-info');
    const inputs = editInfo.querySelectorAll('input, select');
    const printButton = document.getElementById('print-btn');
    const pdfButton = document.getElementById('pdf-btn');
    const addRowBtn = document.getElementById('add-row-cd');
    const removeRowBtn = document.getElementById('remove-row-cd');

    // Hide inputs, selects, buttons, add/remove buttons before PDF generation
    inputs.forEach(input => (input.style.display = 'none'));
    printButton.style.display = 'none';
    pdfButton.style.display = 'none';
    if (addRowBtn) addRowBtn.style.display = 'none';
    if (removeRowBtn) removeRowBtn.style.display = 'none';

    // Insert spans with values instead of inputs/selects
    inputs.forEach(input => {
        const span = document.createElement('span');
        span.textContent = input.type === 'date' ? formatDateForPrint(input.value) : input.value;
        span.classList.add('print-span');
        span.style.marginRight = '20px';
        input.parentNode.insertBefore(span, input);
    });

    // Replace course details inputs with spans for PDF
    handleCourseDetailsPrintMode(true);

 });


    </script>
</body>
</html>
